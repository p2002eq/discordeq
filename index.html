<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>DiscordEQ by Xackery</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/Xackery/discordeq">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/Xackery/discordeq/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/Xackery/discordeq/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Discordeq</h1>
          <p>This plugin allows Everquest Private Servers (eqemu) to communicate with Discord in a bidirectional manner.</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/Xackery">Xackery</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h3>
<a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>I.</h3>

<p><a href="https://discordapp.com/">Discord</a> is an all-in-one voice and text chat for gamers that’s free, secure, and works on both your desktop and phone. Stop paying for TeamSpeak servers and hassling with Skype. Simplify your life.

This tool takes Discord and makes it able to communicate with everquest's OOC chat. It can be accomplished without needing to restart your EQEMU server.</p>



<h3>
<a id="designer-templates" class="anchor" href="#designer-templates" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 1: Join Discord</h3>

<p><a href="https://discord.gg/0lwW4DnAyID7E7wi">Join Discord</a> and set an email/password. On the bottom left corner, select the circle with a + sign to create a new server, like this: <img src="http://i.imgur.com/RusOw1P.png"/><br>
Follow the process of creating a new server, and when it's complete, click the <img src="http://i.imgur.com/bb4sAvW.png"/> Text Channels + sign, to create a new channel, name it ooc.<br>
 Next, right click the #ooc channel and copy link address like this: <img src="http://i.imgur.com/e9tXEvV.png"/>. You'll get a link address that is a series of numbers, which appears like so: https://discordapp.com/channels/13843837170063711/142522212203626111. The numbers will be different for yours. The first set of #s is your serverid, the second set of #s is your channelid. These are used on the next step</p>

<h3>
<a id="designer-templates" class="anchor" href="#designer-templates" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 2: Add discord XML entries.</h3>

<p>

Inside your eqemu_config.xml below the directory entries, add the discord like below. (It should be nested within your world elements)

<pre>
  </directories>

<!-- Discord Configuration -->
  <discord>
    <username>yourlogin@goeshere.com</username>
    <password>yourpasswordgoeshere</password>
    <serverid>0000000000</serverid>
    <channelid>0000000000</channelid>
    <refreshrate>5</refreshrate>
  </discord>
</pre>

Replace the serverid and channelid fields with the numbers you got on the above step, as well as changing username/password. (Later, you may want to create another account called [Bot] for doing any talking.)
</p>


<h3>
<a id="designer-templates" class="anchor" href="#designer-templates" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 3: Enable Chat Logging</h3>

<p>Enabling chat logging is as simple as running this SQL command: <code>UPDATE rule_values SET rule_value = 'true' WHERE rule_name ='QueryServ:PlayerChatLogging' AND ruleset_id = 1;</code><br>
Once the command is ran, you can go in game as a GM account and type in <code>#reloadallrules</code>.<br>
You can verify it is working by running the command <code>SELECT * FROM qs_player_speech;</code>. If entries exist in there, it is working successfluly.</p>


<h3>
<a id="designer-templates" class="anchor" href="#designer-templates" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 4: Add the Quest NPC</h3>

<p>In the game somewhere, you need to add a quest to an NPC that is in a static zone, and ideally the NPC is unkillable, since he is responsible for connecting discord's conversations to in game. Add the following code to your quest NPC:
<pre>
my $lastId = 0;

sub EVENT_SPAWN {
    #Get last ID
    $connect = plugin::LoadMysql();
    $query = "SELECT `id` FROM qs_player_speech ORDER BY `id` DESC LIMIT 1";
    $query_handle = $connect->prepare($query);
    $query_handle->execute();
    while (@row = $query_handle->fetchrow_array()){
        $lastId = $row[0];
    }
      quest::settimer("discord", 1);
}

sub EVENT_TIMER {
    $connect = plugin::LoadMysql();
    $query = "SELECT `from`, `message`, `id` FROM qs_player_speech WHERE `id` > ? AND `type` = 5 AND `to` = '!discord' LIMIT 1";
    $query_handle = $connect->prepare($query);
    $query_handle->execute($lastId);
    while (@row = $query_handle->fetchrow_array()){
        quest::we(260, $row[0]." says from discord, '".$row[1]."'");
        $lastId = $row[2];
    }
    $connect->disconnect;
    return
</pre>
This quest NPC does require the plugin::LoadMysql() method, if you're unsure if you have this, check if your plugins/MySQL.pl file exists.

Once this script is done, you will need to <code>#reloadqst</code> and <code>#repop</code> the zone for the script to load.
</p>


<h3>
<a id="designer-templates" class="anchor" href="#designer-templates" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 5: Grant ability to talk in game</h3>

<p>By default, no users will be able to chat from Discord into Everquest. To enable this, you will need to create Roles representing the name each person represents.<br>
Click the server name on top, and select Server Settings: <img src="http://i.imgur.com/AzqZLKJ.png"><br>
Go to Roles, and create a new role on top section, and call it IGN: *charname* <img src="http://i.imgur.com/0GYMx1I.png"><br>

Now, copy the discordeq.exe file to the same directory your eqemu_config.xml resides, and run it. Try talking in the #ooc channel, and see if it registers in game.
</p>


<h3>
<a id="designer-templates" class="anchor" href="#designer-templates" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Troubleshooting</h3>

<p><b>eqemu_config: Error decoding config: XML syntax error on line 131: unexpected EOF</b> is an error that happens when the first line of your eqemu_config.xml should look like this: ?xml version="1.0"?, note the ? on ending, if there's no ? on ending it will fail to parse.<br>

There's 3 parts to make this work:<br>
<br>
1 is discordeq.exe, it handles all discord chat, read/writing to DB<br>
2 is the DB, it uses the qs_player_speech table to provide info for the other two steps<br>
3 is the quest script, it handles parsing DB entries that discord puts in (they have a to field of !discord) and broadcasts it in game.<br>
Trail the steps back and forth based on where the challenge lies.
</p>



<h3>
<a id="creating-pages-manually" class="anchor" href="#creating-pages-manually" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating pages manually</h3>

<p>If you prefer to not use the automatic generator, push a branch named <code>gh-pages</code> to your repository to create a page manually. In addition to supporting regular HTML content, GitHub Pages support Jekyll, a simple, blog aware static site generator. Jekyll makes it easy to create site-wide headers and footers without having to copy them across every page. It also offers intelligent blog support and other advanced templating features.</p>

<h3>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<p>You can <a href="https://help.github.com/articles/basic-writing-and-formatting-syntax/#mentioning-users-and-teams" class="user-mention">@mention</a> a GitHub username to generate a link to their profile. The resulting <code>&lt;a&gt;</code> element will link to the contributor’s GitHub Profile. For example: In 2007, Chris Wanstrath (<a href="https://github.com/defunkt" class="user-mention">@defunkt</a>), PJ Hyett (<a href="https://github.com/pjhyett" class="user-mention">@pjhyett</a>), and Tom Preston-Werner (<a href="https://github.com/mojombo" class="user-mention">@mojombo</a>) founded GitHub.</p>

<h3>
<a id="support-or-contact" class="anchor" href="#support-or-contact" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Support or Contact</h3>

<p>Having trouble with Pages? Check out our <a href="https://help.github.com/pages">documentation</a> or <a href="https://github.com/contact">contact support</a> and we’ll help you sort it out.</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
